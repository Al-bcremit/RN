{"version":3,"names":["useEffect","useRef","makeMutable","registerSensor","unregisterSensor","SensorType","initSensorData","sensorType","ROTATION","qw","qx","qy","qz","yaw","pitch","roll","x","y","z","useAnimatedSensor","userConfig","ref","sensor","unregister","isAvailable","config","interval","current","sensorData","id","data","value"],"sources":["useAnimatedSensor.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { makeMutable, registerSensor, unregisterSensor } from '../core';\nimport { SharedValue, Value3D, ValueRotation } from '../commonTypes';\n\nexport enum SensorType {\n  ACCELEROMETER = 1,\n  GYROSCOPE = 2,\n  GRAVITY = 3,\n  MAGNETIC_FIELD = 4,\n  ROTATION = 5,\n}\n\nexport type SensorConfig = {\n  interval: number | 'auto';\n};\n\nexport type AnimatedSensor = {\n  sensor: SharedValue<Value3D | ValueRotation>;\n  unregister: () => void;\n  isAvailable: boolean;\n  config: SensorConfig;\n};\n\nfunction initSensorData(\n  sensorType: SensorType\n): SharedValue<Value3D | ValueRotation> {\n  if (sensorType === SensorType.ROTATION) {\n    return makeMutable<Value3D | ValueRotation>({\n      qw: 0,\n      qx: 0,\n      qy: 0,\n      qz: 0,\n      yaw: 0,\n      pitch: 0,\n      roll: 0,\n    });\n  } else {\n    return makeMutable<Value3D | ValueRotation>({\n      x: 0,\n      y: 0,\n      z: 0,\n    });\n  }\n}\n\nexport function useAnimatedSensor(\n  sensorType: SensorType,\n  userConfig?: SensorConfig\n): AnimatedSensor {\n  const ref = useRef<AnimatedSensor>({\n    sensor: initSensorData(sensorType),\n    unregister: () => {\n      // NOOP\n    },\n    isAvailable: false,\n    config: {\n      interval: 0,\n    },\n  });\n\n  useEffect(() => {\n    ref.current.config = { interval: 'auto', ...userConfig };\n    const sensorData = ref.current.sensor!;\n    const id = registerSensor(\n      sensorType,\n      ref.current.config.interval === 'auto' ? -1 : ref.current.config.interval,\n      (data) => {\n        'worklet';\n        sensorData.value = data;\n      }\n    );\n\n    if (id !== -1) {\n      // if sensor is available\n      ref.current.unregister = () => unregisterSensor(id);\n      ref.current.isAvailable = true;\n    } else {\n      // if sensor is unavailable\n      ref.current.unregister = () => {\n        // NOOP\n      };\n      ref.current.isAvailable = false;\n    }\n\n    return () => {\n      ref.current.unregister();\n    };\n  }, [sensorType, userConfig]);\n\n  return ref.current;\n}\n"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,MAApB,QAAkC,OAAlC;AACA,SAASC,WAAT,EAAsBC,cAAtB,EAAsCC,gBAAtC,QAA8D,SAA9D;AAGA,WAAYC,UAAZ;;WAAYA,U;EAAAA,U,CAAAA,U;EAAAA,U,CAAAA,U;EAAAA,U,CAAAA,U;EAAAA,U,CAAAA,U;EAAAA,U,CAAAA,U;GAAAA,U,KAAAA,U;;AAmBZ,SAASC,cAAT,CACEC,UADF,EAEwC;EACtC,IAAIA,UAAU,KAAKF,UAAU,CAACG,QAA9B,EAAwC;IACtC,OAAON,WAAW,CAA0B;MAC1CO,EAAE,EAAE,CADsC;MAE1CC,EAAE,EAAE,CAFsC;MAG1CC,EAAE,EAAE,CAHsC;MAI1CC,EAAE,EAAE,CAJsC;MAK1CC,GAAG,EAAE,CALqC;MAM1CC,KAAK,EAAE,CANmC;MAO1CC,IAAI,EAAE;IAPoC,CAA1B,CAAlB;EASD,CAVD,MAUO;IACL,OAAOb,WAAW,CAA0B;MAC1Cc,CAAC,EAAE,CADuC;MAE1CC,CAAC,EAAE,CAFuC;MAG1CC,CAAC,EAAE;IAHuC,CAA1B,CAAlB;EAKD;AACF;;AAED,OAAO,SAASC,iBAAT,CACLZ,UADK,EAELa,UAFK,EAGW;EAChB,MAAMC,GAAG,GAAGpB,MAAM,CAAiB;IACjCqB,MAAM,EAAEhB,cAAc,CAACC,UAAD,CADW;IAEjCgB,UAAU,EAAE,MAAM,CAChB;IACD,CAJgC;IAKjCC,WAAW,EAAE,KALoB;IAMjCC,MAAM,EAAE;MACNC,QAAQ,EAAE;IADJ;EANyB,CAAjB,CAAlB;EAWA1B,SAAS,CAAC,MAAM;IACdqB,GAAG,CAACM,OAAJ,CAAYF,MAAZ,GAAqB;MAAEC,QAAQ,EAAE,MAAZ;MAAoB,GAAGN;IAAvB,CAArB;IACA,MAAMQ,UAAU,GAAGP,GAAG,CAACM,OAAJ,CAAYL,MAA/B;IACA,MAAMO,EAAE,GAAG1B,cAAc,CACvBI,UADuB,EAEvBc,GAAG,CAACM,OAAJ,CAAYF,MAAZ,CAAmBC,QAAnB,KAAgC,MAAhC,GAAyC,CAAC,CAA1C,GAA8CL,GAAG,CAACM,OAAJ,CAAYF,MAAZ,CAAmBC,QAF1C,EAGtBI,IAAD,IAAU;MACR;;MACAF,UAAU,CAACG,KAAX,GAAmBD,IAAnB;IACD,CANsB,CAAzB;;IASA,IAAID,EAAE,KAAK,CAAC,CAAZ,EAAe;MACb;MACAR,GAAG,CAACM,OAAJ,CAAYJ,UAAZ,GAAyB,MAAMnB,gBAAgB,CAACyB,EAAD,CAA/C;;MACAR,GAAG,CAACM,OAAJ,CAAYH,WAAZ,GAA0B,IAA1B;IACD,CAJD,MAIO;MACL;MACAH,GAAG,CAACM,OAAJ,CAAYJ,UAAZ,GAAyB,MAAM,CAC7B;MACD,CAFD;;MAGAF,GAAG,CAACM,OAAJ,CAAYH,WAAZ,GAA0B,KAA1B;IACD;;IAED,OAAO,MAAM;MACXH,GAAG,CAACM,OAAJ,CAAYJ,UAAZ;IACD,CAFD;EAGD,CA3BQ,EA2BN,CAAChB,UAAD,EAAaa,UAAb,CA3BM,CAAT;EA6BA,OAAOC,GAAG,CAACM,OAAX;AACD"}